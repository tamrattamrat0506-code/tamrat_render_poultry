<!-- clothings/clothing_create.html -->
{% extends 'base/base.html' %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
    {% trans "Create Clothing | Ethiopian Sheger Market place" %}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'clothings/css/clothing_create.css' %}">
{% endblock %}

{% block content %}
<div class="product-create-container">
    <div class="form-header">
        <h1><i class="fas fa-tshirt"></i> {% trans "Add New Clothing Item" %}</h1>
        <p class="subtitle">{% trans "Fill out the form below to list your clothing item" %}</p>
    </div>

    <form method="post" enctype="multipart/form-data" id="clothingForm" class="product-form">
        {% csrf_token %}
        
        <div class="form-section">
            <h2 class="section-title">{% trans "Basic Information" %}</h2>

            <div class="form-grid">
                <div class="form-group">
                    {{ form.name|as_crispy_field }}
                </div>
                
                <div class="mb-3">
            <label for="{{ form.category.id_for_label }}" class="form-label">
                {{ form.category.label }}
                {% if form.category.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            <select name="{{ form.category.name }}" id="{{ form.category.id_for_label }}" 
            class="form-select {% if form.category.errors %}is-invalid{% endif %}"
            {% if form.category.field.required %}required{% endif %}>
        {% if form.category.field.empty_label %}
            <option value="" selected disabled>{{ form.category.field.empty_label }}</option>
        {% endif %}
        {% for value, label in form.category.field.choices %}
            <option value="{{ value }}" {% if form.category.value == value %}selected{% endif %}>
                {{ label }}
            </option>
        {% endfor %}
    </select>
    {% if form.category.help_text %}
        <div class="form-text">{{ form.category.help_text }}</div>
    {% endif %}
    {% for error in form.category.errors %}
        <div class="invalid-feedback d-block">{{ error }}</div>
    {% endfor %}
        </div>
                <div class="form-group">
                    {{ form.price|as_crispy_field }}
                    <div class="price-preview">
                        <span id="priceDisplay">0.00</span> {% trans "ETB" %}
                    </div>
                </div>
                
                <div class="form-group">
                    {{ form.discount_price|as_crispy_field }}
                    <div class="discount-info">
                        <span id="discountPercentage">0%</span> off
                        <span id="discountAmount">(0.00 {% trans "ETB" %})</span>
                    </div>
                </div>
                
                <div class="form-group">
                    {{ form.stock_quantity|as_crispy_field }}
                    <div class="stock-indicator">
                        <div class="stock-bar" id="stockBar"></div>
                        <span id="stockStatus">{% trans "In Stock" %}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2 class="section-title">{% trans "Item Details" %}</h2>
            
            <div class="form-group full-width">
                {{ form.description|as_crispy_field }}
                <div class="char-counter">
                    <span id="charCount">0</span>/1000 {% trans "characters" %}
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2 class="section-title">{% trans "Images" %}</h2>
            
            <div class="image-upload-container">
                <div class="image-dropzone" id="imageDropzone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>{% trans "Drag & drop images here or click to browse" %}</p>
                    <input type="file" name="images" id="imageInput" multiple accept="image/*">
                </div>
                
                <div class="image-preview-container" id="imagePreviewContainer">
                </div>
                
                <div class="image-notes">
                    <p><i class="fas fa-info-circle"></i> {% trans "First image will be used as the main display image" %}</p>
                    <p><i class="fas fa-info-circle"></i> {% trans "Recommended size: 800x1000 pixels" %}</p>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2 class="section-title">{% trans "Features" %}</h2>
            
            <div class="feature-toggle">
                {{ form.is_featured|as_crispy_field }}
                <div class="toggle-switch">
                    <input type="checkbox" id="featureToggle" name="is_featured">
                    <label for="featureToggle"></label>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-submit">
                <i class="fas fa-save"></i> {% trans "Save Item" %}
            </button>
            <button type="button" class="btn-preview" id="previewBtn">
                <i class="fas fa-eye"></i> {% trans "Preview" %}
            </button>
            <a href="{% url 'clothings:clothing_list' %}" class="btn-cancel">
                <i class="fas fa-times"></i> {% trans "Cancel" %}
            </a>
        </div>
    </form>
</div>

<div class="modal" id="sizeChartModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>{% trans "Clothing Size Chart" %}</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="size-chart">
                <table>
                    <thead>
                        <tr>
                            <th>{% trans "Size" %}</th>
                            <th>{% trans "Chest (in)" %}</th>
                            <th>{% trans "Waist (in)" %}</th>
                            <th>{% trans "Hip (in)" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{% trans "XS" %}</td>
                            <td>32-34</td>
                            <td>24-26</td>
                            <td>34-36</td>
                        </tr>
                        <tr>
                            <td>{% trans "S" %}</td>
                            <td>35-37</td>
                            <td>27-29</td>
                            <td>37-39</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="previewModal">
    <div class="modal-content preview-content">
        
    </div>
</div>
{% endblock %}

{% block js %}
<script src="{% static 'clothings/js/clothing_create.js' %}"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<script>
$(document).ready(function() {
    // Initialize Select2
    $('#{{ form.category.id_for_label }}').select2({
        placeholder: "Select a category",
        allowClear: true,
        width: '100%',
        dropdownParent: $('.clothing-create-container')  // Important for modal compatibility
    });
    
    // If still not working, try forcing the options to show:
    setTimeout(function() {
        $('#{{ form.category.id_for_label }}').html(`
            <option value="" selected disabled>Select a category</option>
            {% for category in form.category.field.queryset %}
                <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
        `).trigger('change');
    }, 200);
});
</script>
{% endblock %}