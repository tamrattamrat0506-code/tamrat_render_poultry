{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block css %}
<link rel="stylesheet" href="{% static 'poultryitems/css/egg_sellers.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="egg-sellers-container">
    <h2>{% trans "Egg Sellers" %}</h2>
    <!-- Filter Form -->
    <!-- Filter Section -->
    <div class="filter-section">
        <button class="filter-toggle-btn">
            <i class="fas fa-filter"></i> {% trans "Filters" %}
        </button>
        
        <div class="filter-collapsible">
            <form method="get" class="filter-form compact-filter">
                <div class="filter-grid">
                    {{ filter_form.as_p }}
                </div>
                <div class="filter-buttons">
                    <button type="submit" class="filter-btn">{% trans "Find" %}</button>
                    <a href="{% url 'poultryitems:egg_sellers' %}" class="clear-btn">{% trans "Cancel" %}</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Links -->
    {% if user.is_staff %}
    <div class="admin-links">
        <a href="{% url 'poultryitems:add_egg_seller' %}" class="btn btn-success">
            <i class="fas fa-plus"></i> {% trans "Add Egg Seller" %}
        </a>
    </div>
    {% endif %}

    <div class="egg-seller-list">
        {% if sellers %}
        <ul>
            {% for seller in sellers %}
            <li class="egg-seller-card {% if seller.is_verified %}verified-seller{% endif %}">
                <div class="egg-seller-header">
                    <div class="egg-seller-name">
                        {{ seller.farm_name }}
                        {% if seller.is_verified %}
                        <span class="verified-badge" title="{% trans 'Verified Seller' %}">
                            <i class="fas fa-check-circle"></i>
                        </span>
                        {% endif %}
                    </div>
                    <!--dropdown arrow-->
                    <div class="dropdown-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                
                <div class="egg-seller-details">
                    <p><strong>{% trans "Location:" %}</strong> {{ seller.city }}{% if seller.state %}, {{ seller.state }}{% endif %}</p>
                    <p><strong>{% trans "Eggs available:" %}</strong> {{ seller.quantity_available|floatformat:0 }}</p>
                    <p><strong>{% trans "Price:" %}</strong> ${{ seller.price_per_dozen }}/{% trans "dozen" %}</p>
                    <p><strong>{% trans "Type:" %}</strong> {{ seller.get_egg_type_display }}</p>
                    {% if seller.certification != 'none' %}
                    <p><strong>{% trans "Certification:" %}</strong> {{ seller.get_certification_display }}</p>
                    {% endif %}
                </div>
                
                <div class="dropdown">
                    <p class="description">{{ seller.description }}</p>
                    
                    <div class="contact-info">
                        <p><strong>{% trans "Contact:" %}</strong> {{ seller.phone }}</p>
                        {% if seller.email %}
                        <p><strong>{% trans "Email:" %}</strong> {{ seller.email }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="order-section">
                        <h4>{% trans "Place Order" %}</h4>
                        <form class="order-form" data-seller-id="{{ seller.id }}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="quantity-{{ seller.id }}">{% trans "Quantity (dozens):" %}</label>
                                <input type="number" id="quantity-{{ seller.id }}" name="quantity" 
                                       min="{{ seller.min_order_quantity }}" 
                                       value="{{ seller.min_order_quantity }}" 
                                       class="quantity-input">
                            </div>
                            <button type="button" class="order-btn" data-seller-id="{{ seller.id }}">
                                {% trans "Order Now" %} - $<span class="total-price" data-original-price="{{ seller.price_per_dozen }}">{{ seller.price_per_dozen }}</span>
                            </button>
                        </form>
                    </div>
                    {% if user.is_staff %}
                <div class="seller-actions">
                    <a href="{% url 'poultryitems:edit_egg_seller' seller.pk %}" class="btn-edit" title="Edit">
                        <i class="fas fa-edit"></i> {% trans "Edit" %}
                    </a>
                    <button class="btn-delete" 
                            title="Delete" 
                            data-seller-id="{{ seller.pk }}" 
                            data-seller-name="{{ seller.farm_name }}">
                        <i class="fas fa-trash"></i> {% trans "Delete" %}
                    </button>
                    <a href="{% url 'poultryitems:delete_egg_seller' seller.pk %}" class="btn-delete-page">
                        <i class="fas fa-trash"></i> {% trans "Delete (Page)" %}
                    </a>
                </div>
                {% endif %}
                    <div class="social-links">
                        {% if seller.facebook %}
                        <a href="{{ seller.facebook }}" class="social-link facebook" target="_blank">
                            <i class="fab fa-facebook"></i>
                        </a>
                        {% endif %}
                        {% if seller.telegram %}
                        <a href="{{ seller.telegram }}" class="social-link telegram" target="_blank">
                            <i class="fab fa-telegram"></i>
                        </a>
                        {% endif %}
                        {% if seller.email %}
                        <a href="mailto:{{ seller.email }}" class="social-link email">
                            <i class="far fa-envelope"></i>
                        </a>
                        {% endif %}
                        {% if seller.instagram %}
                        <a href="{{ seller.instagram }}" class="social-link instagram" target="_blank">
                            <i class="fab fa-instagram"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="no-sellers">
            <p>{% trans "No egg sellers found matching your criteria." %}</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Delete Modal -->
<div id="deleteEggModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>{% trans "Confirm Delete" %}</h3>
        <p>{% trans "Are you sure you want to delete" %} <span id="eggSellerName"></span>?</p>
        <div class="modal-actions">
            <button id="confirmEggDelete" class="btn-danger">{% trans "Delete" %}</button>
            <button id="cancelEggDelete" class="btn-secondary">{% trans "Cancel" %}</button>
        </div>
    </div>
</div>

<!-- Order Modal -->
<div id="orderModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>{% trans "Place Your Order" %}</h3>
        <form id="orderForm" action="{% url 'poultryitems:place_egg_order' %}" method="post">
            {% csrf_token %}
            <input type="hidden" id="modalSellerId" name="seller_id">
            
            <div class="form-group">
                <label for="customerName">{% trans "Your Name:" %}</label>
                <input type="text" id="customerName" name="customer_name" required>
            </div>
            <div class="form-group">
                <label for="customerEmail">{% trans "Email:" %}</label>
                <input type="email" id="customerEmail" name="customer_email" required>
            </div>
            <div class="form-group">
                <label for="customerPhone">{% trans "Phone:" %}</label>
                <input type="tel" id="customerPhone" name="customer_phone" required>
            </div>
            <div class="form-group">
                <label for="customerAddress">{% trans "Delivery Address:" %}</label>
                <textarea id="customerAddress" name="customer_address" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="quantity">{% trans "Quantity (dozens):" %}</label>
                <input type="number" id="quantity" name="quantity" min="1" required>
            </div>
            <div class="form-group">
                <label for="deliveryDate">{% trans "Preferred Delivery Date:" %}</label>
                <input type="date" id="deliveryDate" name="preferred_delivery_date">
            </div>
            <div class="form-group">
                <label for="specialInstructions">{% trans "Special Instructions:" %}</label>
                <textarea id="specialInstructions" name="special_instructions" rows="3"></textarea>
            </div>
            <button type="submit" class="submit-btn">{% trans "Confirm Order" %}</button>
        </form>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="{% static 'poultryitems/js/egg_sellers.js' %}"></script>
{% endblock %}